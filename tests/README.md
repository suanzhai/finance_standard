# é‡‘èæœ¯è¯­åŠ è½½å·¥å…· - æµ‹è¯•å¥—ä»¶

è¿™ä¸ªç›®å½•åŒ…å«äº†é‡‘èæœ¯è¯­åŠ è½½å·¥å…·çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼Œå°†åŸæœ¬çš„ä½¿ç”¨ç¤ºä¾‹è½¬æ¢ä¸ºç»“æ„åŒ–çš„å•å…ƒæµ‹è¯•ã€‚

## æµ‹è¯•ç»“æ„

### ğŸ“ æµ‹è¯•æ–‡ä»¶

- `test_configuration.py` - é…ç½®ç®¡ç†æµ‹è¯•
  - ç¯å¢ƒå˜é‡åŠ è½½
  - å‚æ•°éªŒè¯  
  - é…ç½®æ–‡ä»¶å¤„ç†
  - é»˜è®¤å€¼æµ‹è¯•

- `test_finance_term_loader.py` - æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
  - CSVæ–‡ä»¶è¯»å–
  - åµŒå…¥å‘é‡ç”Ÿæˆ
  - Milvusè¿æ¥å’Œé›†åˆåˆ›å»º
  - æ•°æ®æ’å…¥
  - å®Œæ•´å·¥ä½œæµç¨‹

- `test_batch_processing.py` - æ‰¹å¤„ç†åŠŸèƒ½æµ‹è¯•
  - æ‰¹æ¬¡å¤§å°é…ç½®
  - åµŒå…¥å‘é‡æ‰¹å¤„ç†
  - æ•°æ®æ’å…¥æ‰¹å¤„ç†
  - è¿›åº¦è¿½è¸ª
  - è¾¹ç•Œæƒ…å†µæµ‹è¯•

## ğŸš€ è¿è¡Œæµ‹è¯•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
python tests/run_tests.py --install

# è¿è¡Œæ‰€æœ‰å¿«é€Ÿæµ‹è¯•ï¼ˆä¸éœ€è¦APIå¯†é’¥ï¼‰
python tests/run_tests.py

# è¿è¡Œç‰¹å®šæµ‹è¯•
python tests/run_tests.py --test config    # é…ç½®æµ‹è¯•
python tests/run_tests.py --test loader    # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•  
python tests/run_tests.py --test batch     # æ‰¹å¤„ç†æµ‹è¯•
```

### æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨pytest

```bash
# å®‰è£…ä¾èµ–
pip install pytest pytest-mock

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæ–‡ä»¶
pytest tests/test_configuration.py -v
pytest tests/test_finance_term_loader.py -v
pytest tests/test_batch_processing.py -v

# åªè¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆä¸éœ€è¦APIï¼‰
pytest tests/ -v -m "not slow"
```

## ğŸ§ª æµ‹è¯•ç±»å‹

### å¿«é€Ÿæµ‹è¯•ï¼ˆMockï¼‰
- ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡ï¼Œä¸éœ€è¦çœŸå®çš„APIå¯†é’¥
- æµ‹è¯•æ ¸å¿ƒé€»è¾‘å’Œé…ç½®å¤„ç†
- è¿è¡Œé€Ÿåº¦å¿«ï¼Œé€‚åˆå¼€å‘é˜¶æ®µ

### é›†æˆæµ‹è¯•ï¼ˆéœ€è¦APIï¼‰
- éœ€è¦çœŸå®çš„OpenAI APIå¯†é’¥
- æµ‹è¯•å®Œæ•´çš„å·¥ä½œæµç¨‹
- æ ‡è®°ä¸º `@pytest.mark.slow`

## ğŸ“Š æµ‹è¯•è¦†ç›–

### é…ç½®ç®¡ç†æµ‹è¯•
- âœ… ç¯å¢ƒå˜é‡åŠ è½½å’ŒéªŒè¯
- âœ… å‚æ•°è¦†ç›–æœºåˆ¶
- âœ… é»˜è®¤å€¼å¤„ç†
- âœ… é”™è¯¯å¤„ç†ï¼ˆç¼ºå¤±APIå¯†é’¥ç­‰ï¼‰
- âœ… é…ç½®æ–‡ä»¶åŠ è½½
- âœ… æ— æ•ˆé…ç½®å¤„ç†

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•  
- âœ… CSVæ–‡ä»¶è¯»å–å’Œè§£æ
- âœ… æµ‹è¯•æ¨¡å¼é™åˆ¶
- âœ… åµŒå…¥å‘é‡ç”Ÿæˆï¼ˆæ¨¡æ‹Ÿï¼‰
- âœ… Milvusè¿æ¥ï¼ˆLiteå’ŒæœåŠ¡å™¨æ¨¡å¼ï¼‰
- âœ… é›†åˆåˆ›å»ºå’Œç®¡ç†
- âœ… æ•°æ®æ’å…¥
- âœ… å®Œæ•´å·¥ä½œæµç¨‹

### æ‰¹å¤„ç†åŠŸèƒ½æµ‹è¯•
- âœ… æ‰¹æ¬¡å¤§å°é…ç½®
- âœ… åµŒå…¥å‘é‡æ‰¹å¤„ç†é€»è¾‘
- âœ… æ•°æ®åº“æ’å…¥æ‰¹å¤„ç†
- âœ… è¿›åº¦è¿½è¸ªå’Œæ—¶é—´ä¼°ç®—
- âœ… è¾¹ç•Œæƒ…å†µï¼ˆå•é¡¹ã€å¤§æ‰¹æ¬¡ç­‰ï¼‰
- âœ… ä¸åŒé…ç½®ç»„åˆ

### é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… æ–‡ä»¶ä¸å­˜åœ¨
- âœ… æ— æ•ˆCSVç»“æ„
- âœ… ç©ºæ•°æ®å¤„ç†
- âœ… ç½‘ç»œè¿æ¥å¤±è´¥
- âœ… é…ç½®é”™è¯¯

## ğŸ”§ æµ‹è¯•é…ç½®

### pytest.ini
æµ‹è¯•é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ï¼š
- æµ‹è¯•å‘ç°è§„åˆ™
- æ ‡è®°å®šä¹‰ï¼ˆunit, integration, slow, fastï¼‰
- è¾“å‡ºæ ¼å¼
- è­¦å‘Šå¤„ç†

### ç¯å¢ƒå˜é‡
æµ‹è¯•ä¸­ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ï¼š
- `OPENAI_API_KEY` - OpenAI APIå¯†é’¥ï¼ˆé›†æˆæµ‹è¯•éœ€è¦ï¼‰
- `BATCH_SIZE` - æ‰¹å¤„ç†å¤§å°
- `INSERT_BATCH_SIZE` - æ’å…¥æ‰¹æ¬¡å¤§å°
- `TEST_MODE_LIMIT` - æµ‹è¯•æ¨¡å¼é™åˆ¶

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### Mock vs Real
- **Mockæµ‹è¯•**ï¼šæ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ï¼Œä¸“æ³¨äºé€»è¾‘æµ‹è¯•
- **é›†æˆæµ‹è¯•**ï¼šä½¿ç”¨çœŸå®APIå’Œæ•°æ®åº“ï¼ŒéªŒè¯ç«¯åˆ°ç«¯åŠŸèƒ½

### æ•°æ®éš”ç¦»
- æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„ç¯å¢ƒå˜é‡
- ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†
- æ¨¡æ‹Ÿå¯¹è±¡é¿å…å‰¯ä½œç”¨

### å‚æ•°åŒ–æµ‹è¯•
- ä½¿ç”¨ `pytest.mark.parametrize` æµ‹è¯•å¤šç§é…ç½®
- è¦†ç›–å„ç§è¾¹ç•Œæƒ…å†µå’Œé…ç½®ç»„åˆ

## ğŸ“ˆ æ·»åŠ æ–°æµ‹è¯•

### 1. æµ‹è¯•æ–‡ä»¶å‘½å
- æ–‡ä»¶åï¼š`test_<æ¨¡å—å>.py`
- ç±»åï¼š`Test<åŠŸèƒ½å>`
- æ–¹æ³•åï¼š`test_<å…·ä½“åŠŸèƒ½>`

### 2. ä½¿ç”¨Fixtures
```python
@pytest.fixture
def mock_loader():
    with patch.dict(os.environ, {'OPENAI_API_KEY': 'test-key'}):
        return FinanceTermLoader()
```

### 3. ä½¿ç”¨Mock
```python
with patch.object(loader, 'embeddings', mock_embeddings):
    result = loader.generate_embeddings(texts)
```

### 4. å‚æ•°åŒ–æµ‹è¯•
```python
@pytest.mark.parametrize("input,expected", [
    ('100', 100),
    ('500', 500),
    ('', 500),  # é»˜è®¤å€¼
])
def test_batch_size_config(input, expected):
    # æµ‹è¯•ä»£ç 
```

## ğŸ› è°ƒè¯•æµ‹è¯•

### è¯¦ç»†è¾“å‡º
```bash
pytest tests/ -v -s  # -s æ˜¾ç¤ºprintè¾“å‡º
```

### å•ä¸ªæµ‹è¯•
```bash
pytest tests/test_configuration.py::TestConfiguration::test_environment_variable_loading -v
```

### è°ƒè¯•æ¨¡å¼
```bash
pytest tests/ --pdb  # æµ‹è¯•å¤±è´¥æ—¶è¿›å…¥è°ƒè¯•å™¨
```

## ğŸ“ æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•è¿è¡Œåä¼šæ˜¾ç¤ºï¼š
- âœ… é€šè¿‡çš„æµ‹è¯•æ•°é‡
- âŒ å¤±è´¥çš„æµ‹è¯•è¯¦æƒ…
- âš ï¸ è·³è¿‡çš„æµ‹è¯•
- ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ï¼ˆå¦‚æœå®‰è£…äº†coverageæ’ä»¶ï¼‰

## ğŸ” æŒç»­æ”¹è¿›

### æ·»åŠ è¦†ç›–ç‡æŠ¥å‘Š
```bash
pip install pytest-cov
pytest tests/ --cov=src --cov-report=html
```

### å¹¶è¡Œæµ‹è¯•
```bash  
pip install pytest-xdist
pytest tests/ -n auto  # è‡ªåŠ¨å¹¶è¡Œ
```

### æ€§èƒ½æµ‹è¯•
```bash
pip install pytest-benchmark
# åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ benchmark fixture
``` 